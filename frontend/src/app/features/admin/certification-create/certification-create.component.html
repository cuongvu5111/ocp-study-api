<div class="create-cert-container">
    <div class="header-actions">
        <h1>{{ isEditMode() ? 'S·ª≠a Ch·ª©ng Ch·ªâ' : 'T·∫°o Ch·ª©ng Ch·ªâ M·ªõi' }}</h1>
        <button class="btn btn-secondary" routerLink="/admin/certifications">H·ªßy</button>
    </div>

    <div class="card">
        <form [formGroup]="form" (ngSubmit)="onSubmit()">
            <!-- General Info -->
            <div class="form-section">
                <h3>Th√¥ng tin chung</h3>
                <div class="form-group">
                    <label>T√™n ch·ª©ng ch·ªâ</label>
                    <input formControlName="name" placeholder="V√≠ d·ª•: Google Cloud Digital Leader">
                </div>
                <div class="form-group">
                    <label>M√£ ch·ª©ng ch·ªâ (Code)</label>
                    <input formControlName="code" placeholder="V√≠ d·ª•: GCP-DL">
                </div>
                <div class="form-group">
                    <label>M√¥ t·∫£</label>
                    <textarea formControlName="description" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>Icon</label>
                    <div class="icon-grid">
                        <div *ngFor="let icon of icons" class="icon-option"
                            [class.selected]="form.get('icon')?.value === icon" (click)="form.patchValue({icon: icon})">
                            <span class="material-icons-outlined">{{ icon }}</span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Th·ªùi gian h·ªçc (Th√°ng)</label>
                    <select formControlName="durationMonths">
                        <option [value]="1">1 Th√°ng</option>
                        <option [value]="3">3 Th√°ng</option>
                        <option [value]="6">6 Th√°ng</option>
                        <option [value]="12">12 Th√°ng</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Th·ªùi gian b·∫Øt ƒë·∫ßu</label>
                    <input type="date" formControlName="startDate" placeholder="Ch·ªçn ng√†y b·∫Øt ƒë·∫ßu">
                </div>
                <div class="form-group">
                    <label>Th·ªùi gian k·∫øt th√∫c (T·ª± ƒë·ªông t√≠nh)</label>
                    <input type="date" formControlName="endDate" readonly
                        style="background: rgba(255,255,255,0.02); cursor: not-allowed;">
                    <small style="color: #94a3b8; font-size: 0.875rem;">ƒê∆∞·ª£c t√≠nh t·ª± ƒë·ªông d·ª±a tr√™n th·ªùi gian b·∫Øt ƒë·∫ßu +
                        th·ªùi gian h·ªçc</small>
                </div>
            </div>

            <!-- Study Plan -->
            <div class="form-section">
                <h3>L·ªô tr√¨nh h·ªçc</h3>
                <p style="color: #94a3b8; margin-bottom: 1rem;">Th√™m c√°c ch·ªß ƒë·ªÅ (Topics) c·∫ßn h·ªçc cho t·ª´ng th√°ng.</p>

                <div *ngFor="let month of monthsArray" class="month-section">
                    <h4>üìÖ Th√°ng {{ month }}</h4>

                    <div class="topics-list">
                        <div *ngFor="let i of getTopicsForMonth(month)">
                            <div [formGroup]="getTopicControl(i)" class="topic-item">
                                <div>
                                    <label>T√™n Topic</label>
                                    <input formControlName="name" placeholder="T√™n ch·ªß ƒë·ªÅ">
                                </div>
                                <div>
                                    <label>M√¥ t·∫£ ng·∫Øn</label>
                                    <input formControlName="description" placeholder="M√¥ t·∫£">
                                </div>
                                <div>
                                    <label>Icon</label>
                                    <div style="display: flex; gap: 8px; align-items: center;">
                                        <select formControlName="icon" style="flex: 1;">
                                            <option *ngFor="let icon of icons" [value]="icon">{{ icon }}</option>
                                        </select>
                                        <span class="material-icons-outlined">{{ getTopicControl(i).get('icon')?.value
                                            }}</span>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-danger" (click)="removeTopic(i)">
                                    <span class="material-icons-outlined">delete</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <button type="button" class="btn btn-secondary" style="margin-top: 1rem;" (click)="addTopic(month)">
                        + Th√™m Topic v√†o Th√°ng {{ month }}
                    </button>
                </div>
            </div>


            <div class="form-actions">
                <button type="submit" class="btn btn-primary" [disabled]="loading() || form.invalid"
                    style="width: 100%;">
                    {{ loading() ? 'ƒêang t·∫°o...' : 'T·∫°o Ch·ª©ng Ch·ªâ' }}
                </button>
            </div>
        </form>
    </div>
</div>